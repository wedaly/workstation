#!/usr/bin/env sh
set -e

{{ if eq .chezmoi.os "linux" -}}
{{ if eq .chezmoi.osRelease.idLike "debian" -}}
echo "Installing system packages (apt)"
sudo apt update
sudo apt install \
    vim \
    wget \
    curl \
    git \
    tmux \
    keychain \
    tree \
    jq \
    ripgrep \
    fzf \
    python3 \
    python3-pip \
    python3-venv
{{ end -}}

echo "Installing go"
if which go; then
    echo "go is already installed"
else
    export GO_VERSION=1.17.4
    export GO_SHA256SUM=adab2483f644e2f8a10ae93122f0018cef525ca48d0b8764dae87cb5f4fd4206
    export GO_TARBALL="go${GO_VERSION}.linux-amd64.tar.gz"
    (cd /tmp && rm -rf "$GO_TARBALL" && wget https://go.dev/dl/go${GO_VERSION}.linux-amd64.tar.gz && echo "$GO_SHA256SUM  $GO_TARBALL" | sha256sum --check --status)
    sudo tar -C /usr/local -xzf "/tmp/$GO_TARBALL"
fi

{{ else if eq .chezmoi.os "darwin" -}}
echo "Installing system packages (brew)"
brew install --quiet \
    coreutils \
    bash \
    vim \
    wget \
    curl \
    git \
    tmux \
    tree \
    jq \
    ripgrep \
    fzf \
    gnupg \
    python3 \
    go@1.17
{{ end -}}

echo "Installing aretext"
if which aretext; then
    echo "aretext is already installed"
else
    (cd /tmp && git clone https://github.com/aretext/aretext && cd aretext && make install)
fi
